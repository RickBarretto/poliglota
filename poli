#! /usr/bin/env arturo

usage: {:
  COMMANDS:
    new <project>
    new <project> --empty
    add <template> <project>
    add <template> <project> --as <implementation>

  FUTURE?
    add <implementation> <project> --empty
    fill <project>
:}


; -- COMMANDS:

newProject: $[name :string][

    if attr? 'empty [
        write.directory ~"repository/|name|"
        exit
    ]

    copy.directory "templates/" ~"repository/|name|"
    exit
]

addImplementation: $[
    template :string
    project :string
    implementation :string
][
    copy.directory "templates/|template|/"
        ~"repository/|project|/|implementation|"
    exit
]

; -- PARSER

minimal: [args number][
    ensure -> args\[number]
]

parser: $[args][

    case [first args]

    when? [= "new"] [

        drop 'args 1

        if some? ["--help" "-h"] => in? args [
            ; help.new
        ]

        if some? ["--empty" "-e"] => in? args [
            remove 'args ["--empty" "-e"]
            newProject.empty (first args)
        ]

        minimal args 1
        newProject (first args)

    ]

    when? [= "add"] [

        ensure -> arg\2
        (size arg > 2)?
        [
            ensure -> arg\4
            if arg\3 = "--as"
            -> addImplementation arg\1 arg\2 arg\4
        ]
        [
            addImplementation arg\1 arg\2 arg\1
        ]

    ]


    else -> panic "Your arguments: |arg|\n|usage|"

]

try? -> parser arg
else -> panic "Your arguments: |arg|\n|usage|"
