#! /usr/bin/env arturo

usage: {:
  COMMANDS:
    new <project>
    new <project> --empty
    add <template> <project>
    add <template> <project> --as <new name>

  FUTURE?
    fill <project>
:}

new: $[name :string][
    copy.directory "templates/" ~"repository/|name|"
    exit
]

newEmpty: $[name :string][
    write.directory ~"repository/|name|"
    exit
]

addImplementation: $[
    template :string
    project :string
    implementation :string
][
    copy.directory "templates/|template|/"
        ~"repository/|project|/|implementation|"
    exit
]


parser: $[arg][

    case [arg\0]

    when? [= "new"] [

        ensure -> arg\1
        (arg\1 = "--empty")?
        [ ensure -> arg\2, newEmpty arg\2 ]
        [ new arg\1 ]

    ]

    when? [= "add"] [

        ensure -> arg\2
        (size arg > 2)?
        [
            ensure -> arg\4
            if arg\3 = "--as"
            -> addImplementation arg\1 arg\2 arg\4
        ]
        [
            addImplementation arg\1 arg\2 arg\1
        ]

    ]


    else -> panic "Your arguments: |arg|\n|usage|"

]

try? -> parser arg
else -> panic "Your arguments: |arg|\n|usage|"
